<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Öneri & Şikayetler</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/oneriSikayet.css" />
    <style>
      /* Basit tablo stili */

    </style>
  </head>
  <body>
    <div class="sidebar">
      <h2>YAĞMURLU KÖY DERNEĞİ YÖNETİM PANELİ</h2>
      <a href="index.html">
        <i class="fas fa-home"></i>Ana Sayfa
      </a>
      <a href="kullaniciKayit.html">
        <i class="fas fa-user-plus"></i>Kullanıcı Kayıt
      </a>
      <a href="kullaniciBilgileri.html">
        <i class="fas fa-users"></i>Kullanıcı Bilgileri
      </a>
      <a href="gelirGider.html">
        <i class="fas fa-money-bill-wave"></i>Gelir - Gider
      </a>
      <a href="post.html">
        <i class="fas fa-newspaper"></i>Post Paylaşımı
      </a>
      <a href="reklam.html">
        <i class="fas fa-ad"></i>Reklam
      </a>
      <a href="poll_admin.html"><i class="fas fa-chart-pie"></i> Anketler</a>
      <a href="galeri.html">
        <i class="fas fa-images"></i>Galeri
      </a>
      <a href="oneriSikayet.html" class="active">
        <i class="fas fa-comment-alt"></i>Öneri & Şikayet
      </a>
      <a href="isletme.html"><i class="fas fa-store"></i> İşletmeler</a>
<a href="bildirim.html"><i class="fas fa-bell"></i> Bildirim Gönder</a>
<a href="etkinlik.html"><i class="fas fa-calendar-check"></i> Etkinlikler</a>

                 <a href="about.html" >
        <i class="fas fa-comment-alt"></i>Hakkımızda
      </a>
    </div>

    <div class="main-content">
      <div class="page-header">
        <h3>Öneri & Şikayetler</h3>
      </div>

      <div class="table-container">
        <table class="data-table" id="suggestionComplaintTable">
          <thead>
            <tr>
              <th>Tip</th>
              <th>Başlık</th>
              <th>Mesaj</th>
              <th>Tarih</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <p id="noDataMessage" style="display:none;">
          Henüz herhangi bir öneri veya şikayet bulunamadı.
        </p>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        loadFeedbacks();
      });

      async function loadFeedbacks() {
        const tableBody = document.querySelector(
          "#suggestionComplaintTable tbody"
        );
        const noDataMsg = document.getElementById("noDataMessage");

        try {
          const res = await fetch(
            "https://erkayasoft.com/api/get_feedbacks.php"
          );
          const json = await res.json();
          if (!json.success) throw new Error(json.error || "Api hatası");

          let items = json.data;

          if (!items || items.length === 0) {
            tableBody.innerHTML = "";
            noDataMsg.style.display = "block";
            return;
          }
          noDataMsg.style.display = "none";

          // Tarihe göre (createdAt) en yeniden eskiye sırala
          items.sort((a, b) => {
            return new Date(b.createdAt) - new Date(a.createdAt);
          });

          // Tabloya bas
          tableBody.innerHTML = items
            .map((item) => {
              // Tip metni
              const tip = item.type === "istek" ? "İstek" : "Şikayet";
              // Tarih formatlama
              const dt = new Date(item.createdAt);
              const trDate = dt.toLocaleDateString("tr-TR", {
                day: "numeric",
                month: "long",
                year: "numeric",
                hour: "2-digit",
                minute: "2-digit",
              });
              return `
                <tr>
                  <td>${tip}</td>
                  <td>${item.title}</td>
                  <td>${item.description}</td>
                  <td>${trDate}</td>
                </tr>
              `;
            })
            .join("");
        } catch (e) {
          console.error("Veri yükleme hatası:", e);
          tableBody.innerHTML = `
            <tr><td colspan="4" style="text-align:center; color:red;">
              Veri yüklenirken hata oluştu.
            </td></tr>
          `;
        }
      }
    </script>
  </body>
</html>
