<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>KullanÄ±cÄ± KayÄ±t</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="css/kullaniciKayit.css" />
      <!-- Firebase App (core) ve Realtime Database kÃ¼tÃ¼phaneleri -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>



  </head>
  <body>
    <div class="sidebar">
      <h2>YAÄžMURLU KÃ–Y DERNEÄžÄ° YÃ–NETÄ°M PANELÄ°</h2>
      <a href="index.html">
        <i class="fas fa-home"></i>
        Ana Sayfa
      </a>
      <a href="kullaniciKayit.html" class="active">
        <i class="fas fa-user-plus"></i>
        KullanÄ±cÄ± KayÄ±t
      </a>
      <a href="kullaniciBilgileri.html">
        <i class="fas fa-users"></i>
        KullanÄ±cÄ± Bilgileri
      </a>
      <a href="gelirGider.html">
        <i class="fas fa-money-bill-wave"></i>
        Gelir - Gider
      </a>
      <a href="post.html">
        <i class="fas fa-newspaper"></i>
        Post PaylaÅŸÄ±mÄ±
      </a>
      <a href="reklam.html">
        <i class="fas fa-ad"></i>
        Reklam
      </a>
      <a href="poll_admin.html"><i class="fas fa-chart-pie"></i> Anketler</a>
      <a href="galeri.html">
        <i class="fas fa-images"></i>
        Galeri
      </a>
      <a href="oneriSikayet.html">
        <i class="fas fa-comment-alt"></i>
        Ã–neri & Åžikayet
      </a>

      <a href="isletme.html"><i class="fas fa-store"></i> Ä°ÅŸletmeler</a>
<a href="bildirim.html"><i class="fas fa-bell"></i> Bildirim GÃ¶nder</a>
<a href="etkinlik.html"><i class="fas fa-calendar-check"></i> Etkinlikler</a>

                 <a href="about.html" >
        <i class="fas fa-comment-alt"></i>HakkÄ±mÄ±zda
      </a>
    </div>

    <div class="main-content">
      <div class="menu-buttons">
        <button onclick="showSection('onay')" class="active">KayÄ±t OnayÄ±</button>
        <button onclick="showSection('yeni')">Yeni KayÄ±t OluÅŸtur</button>
      </div>

      <div id="onay" class="section active">
        <h3>KayÄ±t Olan KullanÄ±cÄ±lar</h3>
        <table>
          <thead>
            <tr>
              <th>Ad</th>
              <th>Soyad</th>
              <th>Adres</th>
              <th>Telefon</th>
              <th>TC</th>
              <th>Mail</th>
              <th>Ãœye Durumu</th>
              <th>Ä°ÅŸlem</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Ali</td>
              <td>YÄ±lmaz</td>
              <td>Ankara</td>
              <td>05555555555</td>
              <td>12345678901</td>
              <td>ali@mail.com</td>
              <td><span class="member-status gold">Gold</span></td>
              <td>
                <div class="action-buttons">
                  <button class="btn onay">
                    <i class="fas fa-check"></i>
                    Onayla
                  </button>
                  <button class="btn sil">
                    <i class="fas fa-trash"></i>
                    Sil
                  </button>
                </div>
              </td>
            </tr>
            <tr>
              <td>AyÅŸe</td>
              <td>Kaya</td>
              <td>Ä°stanbul</td>
              <td>05444444444</td>
              <td>98765432109</td>
              <td>ayse@mail.com</td>
              <td><span class="member-status standart">Standart</span></td>
              <td>
                <div class="action-buttons">
                  <button class="btn onay">
                    <i class="fas fa-check"></i>
                    Onayla
                  </button>
                  <button class="btn sil">
                    <i class="fas fa-trash"></i>
                    Sil
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div id="yeni" class="section">
        <h3>Yeni KullanÄ±cÄ± KaydÄ±</h3>
        <form>
          <div class="form-group">
            <label for="memberStatus">Ãœye Durumu</label>
            <select id="memberStatus" class="form-control" required>
              <option value="">SeÃ§iniz...</option>
              <option value="gold">Gold</option>
              <option value="standart">Standart</option>
            </select>
          </div>
          <div class="form-group">
            <label for="firstName">Ad</label>
            <input type="text" id="firstName" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="lastName">Soyad</label>
            <input type="text" id="lastName" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="address">Adres</label>
            <input type="text" id="address" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="phone">Telefon</label>
            <input type="tel" id="phone" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="tc">TC Kimlik No</label>
            <input type="text" id="tc" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="email">E-posta</label>
            <input type="email" id="email" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="text">Åžifre</label>
            <input type="text" id="password" class="form-control" required />
          </div>

          <button type="submit" class="submit-btn">
            <i class="fas fa-user-plus"></i>
            KaydÄ± OluÅŸtur
          </button>
        </form>
      </div>
    </div>

    <script>
      function showSection(id) {
        // ButonlarÄ± aktif/pasif yap
        document.querySelectorAll(".menu-buttons button").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.textContent.includes(id === "onay" ? "OnayÄ±" : "OluÅŸtur")) {
            btn.classList.add("active");
          }
        });

        // BÃ¶lÃ¼mleri deÄŸiÅŸtir
        document.querySelectorAll(".section").forEach((section) => {
          section.classList.remove("active");
        });
        document.getElementById(id).classList.add("active");
      }
 const form = document.querySelector(".main-content form");
  form.addEventListener("submit", async function(e) {
    e.preventDefault();
    // DeÄŸerleri al
    const data = {
  status:    document.getElementById("memberStatus").value,
  firstName: document.getElementById("firstName").value.trim(),
  lastName:  document.getElementById("lastName").value.trim(),
  address:   document.getElementById("address").value.trim(),
  phone:     document.getElementById("phone").value.trim(),
  tc:        document.getElementById("tc").value.trim(),
  email:     document.getElementById("email").value.trim(),
  password:  document.getElementById("password").value,
  isActive:  true // âœ… veya false (checkbox ile baÄŸlayabilirsin)
};

    // Basit validasyon
    if (Object.values(data).some(v => !v)) {
      alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurunuz.");
      return;
    }

    try {
const res = await fetch("https://erkayasoft.com/api/add.php", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(data)
});

      const json = await res.json();
      if (!res.ok) throw new Error(json.error || res.statusText);

      alert("KayÄ±t baÅŸarÄ±lÄ±!");
      form.reset();
      showSection("onay");
      loadUsers(); // aÅŸaÄŸÄ±da tanÄ±mlanacak
    } catch (err) {
      alert("Hata: " + err.message);
    }
  });

  // Onay tablosunu dolduracak fonksiyon
async function loadUsers() {
  const tbody = document.querySelector("#onay tbody");
  try {
    const res = await fetch("https://erkayasoft.com/api/kisiler.php");
    const json = await res.json();
    const users = json.data;

    const passiveUsers = users.filter(u => u.isActive == 0 || u.isActive === "0");

    if (passiveUsers.length === 0) {
      tbody.innerHTML = "<tr><td colspan='8'>Onay bekleyen kullanÄ±cÄ± yok.</td></tr>";
      return;
    }

    tbody.innerHTML = passiveUsers.map(u => `
      <tr>
        <td>${u.firstName}</td>
        <td>${u.lastName}</td>
        <td>${u.address}</td>
        <td>${u.phone}</td>
        <td>${u.tc}</td>
        <td>${u.email}</td>
        <td><span class="member-status ${u.status}">${u.status}</span></td>
        <td>
          <div class="action-buttons">
            <button class="btn onay" onclick="approveUser(${u._id})">
              <i class="fas fa-check"></i> Onayla
            </button>
            <button class="btn sil" onclick="deleteUser(${u._id})">
              <i class="fas fa-trash"></i> Sil
            </button>
          </div>
        </td>
      </tr>
    `).join("");
  } catch (err) {
    console.error(err);
    tbody.innerHTML = "<tr><td colspan='8'>Veri alÄ±namadÄ±</td></tr>";
  }
}

async function approveUser(id) {
  try {
    const res = await fetch(`https://erkayasoft.com/api/update.php?id=${id}`, {
      method: "POST", // ðŸ‘ˆ geÃ§ici olarak POST'a Ã§evir
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ isActive: 1 })
    });

    const json = await res.json();
    console.log(json);
  } catch (err) {
    alert("Hata: " + err.message);
  }
}




  // Silme fonksiyonu
async function deleteUser(id) {
  if (!confirm("Silmek istediÄŸinize emin misiniz?")) return;
  const res = await fetch(`https://erkayasoft.com/api/delete.php?id=${id}`, {
    method: "DELETE"
  });
  const json = await res.json();
  if (json.success) {
    alert("KullanÄ±cÄ± silindi");
    loadUsers();
  } else {
    alert("Silme hatasÄ±");
  }
}


  // Sayfa yÃ¼klendiÄŸinde
  loadUsers();
    </script>
  </body>
</html>
